<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>IoT 19-20 Dashboard</title>
    <meta name="description" content="Dashboard for first assignment of IoT 19-20 course @ Sapienza University of Rome" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
  	<meta name="author" content="666TheNumberOfTheBeast" />

    <!--<link rel="apple-touch-icon" href="https://i.imgur.com/QRAUqs9.png">
    <link rel="shortcut icon" href="https://i.imgur.com/QRAUqs9.png">-->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.0/normalize.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lykmapipo/themify-icons@0.1.2/css/themify-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pixeden-stroke-7-icon@1.2.3/pe-icon-7-stroke/dist/pe-icon-7-stroke.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.0/css/flag-icon.min.css">
    <link rel="stylesheet" href="assets/css/cs-skin-elastic.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv.min.js"></script> -->
    <link href="https://cdn.jsdelivr.net/npm/chartist@0.11.0/dist/chartist.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/jqvmap@1.5.1/dist/jqvmap.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/weathericons@2.1.0/css/weather-icons.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@3.9.0/dist/fullcalendar.min.css" rel="stylesheet" />

   <style>
    #weatherWidget .currentDesc {
        color: #ffffff!important;
    }
        .traffic-chart {
            min-height: 335px;
        }
        #flotPie1  {
            height: 150px;
        }
        #flotPie1 td {
            padding:3px;
        }
        #flotPie1 table {
            top: 20px!important;
            right: -10px!important;
        }
        .chart-container {
            display: table;
            min-width: 270px ;
            text-align: left;
            padding-top: 10px;
            padding-bottom: 10px;
        }
        #flotLine5  {
             height: 105px;
        }

        #flotBarChart {
            height: 150px;
        }
        #cellPaiChart{
            height: 160px;
        }

    </style>
</head>

<body>
    <!-- Left Panel -->
    <aside id="left-panel" class="left-panel">
        <nav class="navbar navbar-expand-sm navbar-default">
            <div id="main-menu" class="main-menu collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="active">
                        <a href="index.html"><i class="menu-icon fa fa-laptop"></i>Dashboard </a>
                    </li>
                    <li class="menu-title">UI elements</li><!-- /.menu-title -->
                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-cogs"></i>Components</a>
                        <ul class="sub-menu children dropdown-menu">                            <li><i class="fa fa-puzzle-piece"></i><a href="ui-buttons.html">Buttons</a></li>
                            <li><i class="fa fa-id-badge"></i><a href="ui-badges.html">Badges</a></li>
                            <li><i class="fa fa-bars"></i><a href="ui-tabs.html">Tabs</a></li>

                            <li><i class="fa fa-id-card-o"></i><a href="ui-cards.html">Cards</a></li>
                            <li><i class="fa fa-exclamation-triangle"></i><a href="ui-alerts.html">Alerts</a></li>
                            <li><i class="fa fa-spinner"></i><a href="ui-progressbar.html">Progress Bars</a></li>
                            <li><i class="fa fa-fire"></i><a href="ui-modals.html">Modals</a></li>
                            <li><i class="fa fa-book"></i><a href="ui-switches.html">Switches</a></li>
                            <li><i class="fa fa-th"></i><a href="ui-grids.html">Grids</a></li>
                            <li><i class="fa fa-file-word-o"></i><a href="ui-typgraphy.html">Typography</a></li>
                        </ul>
                    </li>
                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-table"></i>Tables</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="fa fa-table"></i><a href="tables-basic.html">Basic Table</a></li>
                            <li><i class="fa fa-table"></i><a href="tables-data.html">Data Table</a></li>
                        </ul>
                    </li>
                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-th"></i>Forms</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="menu-icon fa fa-th"></i><a href="forms-basic.html">Basic Form</a></li>
                            <li><i class="menu-icon fa fa-th"></i><a href="forms-advanced.html">Advanced Form</a></li>
                        </ul>
                    </li>

                    <li class="menu-title">Icons</li><!-- /.menu-title -->

                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-tasks"></i>Icons</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="menu-icon fa fa-fort-awesome"></i><a href="font-fontawesome.html">Font Awesome</a></li>
                            <li><i class="menu-icon ti-themify-logo"></i><a href="font-themify.html">Themefy Icons</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="widgets.html"> <i class="menu-icon ti-email"></i>Widgets </a>
                    </li>
                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-bar-chart"></i>Charts</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="menu-icon fa fa-line-chart"></i><a href="charts-chartjs.html">Chart JS</a></li>
                            <li><i class="menu-icon fa fa-area-chart"></i><a href="charts-flot.html">Flot Chart</a></li>
                            <li><i class="menu-icon fa fa-pie-chart"></i><a href="charts-peity.html">Peity Chart</a></li>
                        </ul>
                    </li>

                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-area-chart"></i>Maps</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="menu-icon fa fa-map-o"></i><a href="maps-gmap.html">Google Maps</a></li>
                            <li><i class="menu-icon fa fa-street-view"></i><a href="maps-vector.html">Vector Maps</a></li>
                        </ul>
                    </li>
                    <li class="menu-title">Extras</li><!-- /.menu-title -->
                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-glass"></i>Pages</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="menu-icon fa fa-sign-in"></i><a href="page-login.html">Login</a></li>
                            <li><i class="menu-icon fa fa-sign-in"></i><a href="page-register.html">Register</a></li>
                            <li><i class="menu-icon fa fa-paper-plane"></i><a href="pages-forget.html">Forget Pass</a></li>
                        </ul>
                    </li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </nav>
    </aside>
    <!-- /#left-panel -->
    <!-- Right Panel -->
    <div id="right-panel" class="right-panel">
        <!-- Header-->
        <header id="header" class="header">
            <div class="top-left">
                <div class="navbar-header">
                    <a class="navbar-brand" href="../index.html"><i class="fa fa-home"><i> Internet Of Things 19-20</i></i><!--<img src="images/logo.png" alt="Logo">--></a>
                    <a class="navbar-brand hidden" href="../index.html">IoT 19-20 <!--<img src="images/logo2.png" alt="Logo">--></a>
                    <a id="menuToggle" class="menutoggle"><i class="fa fa-bars"></i></a>
                </div>
            </div>
            <!--<div class="top-right">
                <div class="header-menu">
                    <div class="header-left">
                        <button class="search-trigger"><i class="fa fa-search"></i></button>
                        <div class="form-inline">
                            <form class="search-form">
                                <input class="form-control mr-sm-2" type="text" placeholder="Search ..." aria-label="Search">
                                <button class="search-close" type="submit"><i class="fa fa-close"></i></button>
                            </form>
                        </div>

                        <div class="dropdown for-notification">
                            <button class="btn btn-secondary dropdown-toggle" type="button" id="notification" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fa fa-bell"></i>
                                <span class="count bg-danger">3</span>
                            </button>
                            <div class="dropdown-menu" aria-labelledby="notification">
                                <p class="red">You have 3 Notification</p>
                                <a class="dropdown-item media" href="#">
                                    <i class="fa fa-check"></i>
                                    <p>Server #1 overloaded.</p>
                                </a>
                                <a class="dropdown-item media" href="#">
                                    <i class="fa fa-info"></i>
                                    <p>Server #2 overloaded.</p>
                                </a>
                                <a class="dropdown-item media" href="#">
                                    <i class="fa fa-warning"></i>
                                    <p>Server #3 overloaded.</p>
                                </a>
                            </div>
                        </div>

                        <div class="dropdown for-message">
                            <button class="btn btn-secondary dropdown-toggle" type="button" id="message" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fa fa-envelope"></i>
                                <span class="count bg-primary">4</span>
                            </button>
                            <div class="dropdown-menu" aria-labelledby="message">
                                <p class="red">You have 4 Mails</p>
                                <a class="dropdown-item media" href="#">
                                    <span class="photo media-left"><img alt="avatar" src="images/avatar/1.jpg"></span>
                                    <div class="message media-body">
                                        <span class="name float-left">Jonathan Smith</span>
                                        <span class="time float-right">Just now</span>
                                        <p>Hello, this is an example msg</p>
                                    </div>
                                </a>
                                <a class="dropdown-item media" href="#">
                                    <span class="photo media-left"><img alt="avatar" src="images/avatar/2.jpg"></span>
                                    <div class="message media-body">
                                        <span class="name float-left">Jack Sanders</span>
                                        <span class="time float-right">5 minutes ago</span>
                                        <p>Lorem ipsum dolor sit amet, consectetur</p>
                                    </div>
                                </a>
                                <a class="dropdown-item media" href="#">
                                    <span class="photo media-left"><img alt="avatar" src="images/avatar/3.jpg"></span>
                                    <div class="message media-body">
                                        <span class="name float-left">Cheryl Wheeler</span>
                                        <span class="time float-right">10 minutes ago</span>
                                        <p>Hello, this is an example msg</p>
                                    </div>
                                </a>
                                <a class="dropdown-item media" href="#">
                                    <span class="photo media-left"><img alt="avatar" src="images/avatar/4.jpg"></span>
                                    <div class="message media-body">
                                        <span class="name float-left">Rachel Santos</span>
                                        <span class="time float-right">15 minutes ago</span>
                                        <p>Lorem ipsum dolor sit amet, consectetur</p>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="user-area dropdown float-right">
                        <a href="#" class="dropdown-toggle active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="user-avatar rounded-circle" src="images/admin.jpg" alt="User Avatar">
                        </a>

                        <div class="user-menu dropdown-menu">
                            <a class="nav-link" href="#"><i class="fa fa- user"></i>My Profile</a>

                            <a class="nav-link" href="#"><i class="fa fa- user"></i>Notifications <span class="count">13</span></a>

                            <a class="nav-link" href="#"><i class="fa fa -cog"></i>Settings</a>

                            <a class="nav-link" href="#"><i class="fa fa-power -off"></i>Logout</a>
                        </div>
                    </div>

                </div>
            </div>-->
        </header>
        <!-- /#header -->
        <!-- Content -->
        <div class="content">
            <!-- Animated -->
            <div class="animated fadeIn">
                <!-- Widgets  -->
                <!--<div class="row">
                    <div class="col-lg-3 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="stat-widget-five">
                                    <div class="stat-icon dib flat-color-4">-->
                                        <!--<i class="pe-7s-cash"></i>-->
                                        <!--<i class="pe-7s-sun"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="text-left dib">
                                            <div class="stat-text"><span class="count">23569</span></div>
                                            <div class="stat-heading">Stations</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>-->

                    <!--<div class="col-lg-3 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="stat-widget-five">
                                    <div class="stat-icon dib flat-color-2">
                                        <i class="pe-7s-cart"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="text-left dib">
                                            <div class="stat-text"><span class="count">3435</span></div>
                                            <div class="stat-heading">Sales</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="stat-widget-five">
                                    <div class="stat-icon dib flat-color-3">
                                        <i class="pe-7s-browser"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="text-left dib">
                                            <div class="stat-text"><span class="count">349</span></div>
                                            <div class="stat-heading">Templates</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="stat-widget-five">
                                    <div class="stat-icon dib flat-color-4">
                                        <i class="pe-7s-users"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="text-left dib">
                                            <div class="stat-text"><span class="count">2986</span></div>
                                            <div class="stat-heading">Clients</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                  </div>-->
                <!-- /Widgets -->

                <style>
                .clickable-row {
                    cursor: pointer;
                }

                .clickable-row:hover {
                  background-color: #f2f2f2;
                }

                .clickable-card {
                    cursor: pointer;
                }

                .clickable-card:hover {
                  filter: brightness(85%);
                }

                html {
                  scroll-behavior: smooth;
                }

                </style>

                <!-- Orders -->
                <div class="orders">
                    <div class="row">
                        <div class="col-xl-8">
                            <div class="card">
                                <div class="card-body">
                                  <div class="stat-widget-five">
                                      <div class="stat-icon dib flat-color-4">
                                          <i class="pe-7s-sun"></i>
                                      </div>
                                      <div class="stat-content">
                                          <div class="text-left dib">
                                              <div class="stat-text"><span id="stations_number"></span></div>
                                              <div class="stat-heading">Stations</div>
                                          </div>
                                      </div>
                                  </div><!---->
                                    <!--<h4 class="box-title">Stations</h4>-->
                                </div>
                                <div class="card-body--">
                                    <div class="table-stats order-table ov-h">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th class="serial">#</th>
                                                    <th class="avatar">Avatar</th>
                                                    <th>ID</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody id="stations-table-body">
                                                <!--<tr class='clickable-row' data-href="#real-time">
                                                    <td class="serial">1.</td>
                                                    <td class="avatar">
                                                        <div class="round-img">
                                                            <img class="rounded-circle" src="images/avatar/avatar1.png" alt="">
                                                        </div>
                                                    </td>
                                                    <td> #5469 </td>
                                                    <td>
                                                        <span class="badge badge-complete">Online</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="serial">2.</td>
                                                    <td class="avatar">
                                                        <div class="round-img">
                                                            <a href="#"><img class="rounded-circle" src="images/avatar/avatar2.png" alt=""></a>
                                                        </div>
                                                    </td>
                                                    <td> #5468 </td>
                                                    <td>
                                                        <span class="badge badge-complete">Online</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="serial">3.</td>
                                                    <td class="avatar">
                                                        <div class="round-img">
                                                            <a href="#"><img class="rounded-circle" src="images/avatar/avatar3.png" alt=""></a>
                                                        </div>
                                                    </td>
                                                    <td> #5467 </td>
                                                    <td>
                                                        <span class="badge badge-complete">Online</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="serial">4.</td>
                                                    <td class="avatar">
                                                        <div class="round-img">
                                                            <a href="#"><img class="rounded-circle" src="images/avatar/avatar4.png" alt=""></a>
                                                        </div>
                                                    </td>
                                                    <td> #5466 </td>
                                                    <td>
                                                        <span class="badge badge-pending">Offline</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="serial">5.</td>
                                                    <td class="avatar">
                                                        <div class="round-img">
                                                            <a href="#"><img class="rounded-circle" src="images/avatar/avatar5.png" alt=""></a>
                                                        </div>
                                                    </td>
                                                    <td> #5465 </td>
                                                    <td>
                                                        <span class="badge badge-complete">Online</span>
                                                    </td>
                                                </tr>-->
                                            </tbody>
                                        </table>
                                    </div> <!-- /.table-stats -->
                                </div>
                            </div> <!-- /.card -->
                        </div>  <!-- /.col-lg-8 -->

                        <!--<div class="col-xl-4">
                            <div class="row">
                                <div class="col-lg-6 col-xl-12">
                                    <div class="card br-0">
                                        <div class="card-body">
                                            <div class="chart-container ov-h">
                                                <div id="flotPie1" class="float-chart"></div>
                                            </div>
                                        </div>
                                    </div>--><!-- /.card -->
                                <!--</div>

                                <div class="col-lg-6 col-xl-12">
                                    <div class="card bg-flat-color-3  ">
                                        <div class="card-body">
                                            <h4 class="card-title m-0  white-color ">August 2018</h4>
                                        </div>
                                         <div class="card-body">
                                             <div id="flotLine5" class="flot-line"></div>
                                         </div>
                                    </div>
                                </div>
                            </div>
                        </div>--> <!-- /.col-md-4 -->
                    </div>
                </div>

                <!--  Traffic  -->
                <!--<div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="box-title">Traffic </h4>
                            </div>
                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="card-body">-->
                                        <!-- <canvas id="TrafficChart"></canvas>   -->
                                        <!--<div id="traffic-chart" class="traffic-chart"></div>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="card-body">
                                        <div class="progress-box progress-1">
                                            <h4 class="por-title">Temperature</h4>
                                            <div class="por-txt">30°C (40%)</div>
                                            <div class="progress mb-2" style="height: 5px;">
                                                <div class="progress-bar bg-flat-color-1" role="progressbar" style="width: 70%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        <div class="progress-box progress-2">
                                            <h4 class="por-title">Humidity</h4>
                                            <div class="por-txt">24%</div>
                                            <div class="progress mb-2" style="height: 5px;">
                                                <div class="progress-bar bg-flat-color-2" role="progressbar" style="width: 24%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        <div class="progress-box progress-2">
                                            <h4 class="por-title">Wind direction</h4>
                                            <div class="por-txt">130° (40%)</div>
                                            <div class="progress mb-2" style="height: 5px;">
                                                <div class="progress-bar bg-flat-color-3" role="progressbar" style="width: 40%;" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        <div class="progress-box progress-2">
                                            <h4 class="por-title">Wind intensity</h4>
                                            <div class="por-txt">15 m/s (15%)</div>
                                            <div class="progress mb-2" style="height: 5px;">
                                                <div class="progress-bar bg-flat-color-4" role="progressbar" style="width: 15%;" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        <div class="progress-box progress-2">
                                            <h4 class="por-title">Rain height</h4>
                                            <div class="por-txt">5 mm/h (10%)</div>
                                            <div class="progress mb-2" style="height: 5px;">
                                                <div class="progress-bar bg-flat-color-5" role="progressbar" style="width: 10%;" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>-->
                                    <!--</div> --><!-- /.card-body -->
                                <!--</div>
                            </div>--> <!-- /.row -->
                            <!--<div id="real-time-pos-for-scrolling" class="card-body"></div>
                        </div>
                    </div>--><!-- /# column -->
                <!--</div>-->
                <!--  /Traffic -->
                <div class="clearfix"></div>

                <!-- Widgets -->
                <div class="row">
                    <div class="col-sm-6 col-lg-4">
                        <div class="card text-white bg-flat-color-1 clickable-card">
                            <div class="card-body">
                                <div class="card-left pt-1 float-left">
                                    <h3 class="mb-0 fw-r">Temperature</h3>
                                    <p class="text-light mt-1 m-0">Show last hour values</p>
                                </div><!-- /.card-left -->

                                <!--<div class="card-right float-right text-right">
                                    <i class="icon fade-5 icon-lg pe-7s-cart"></i>
                                </div>--><!-- /.card-right -->

                            </div>

                        </div>
                    </div><!--/.col-->

                    <div class="col-sm-6 col-lg-4">
                        <div class="card text-white bg-flat-color-6 clickable-card">
                            <div class="card-body">
                                <div class="card-left pt-1 float-left">
                                    <h3 class="mb-0 fw-r">Humidity</h3>
                                    <p class="text-light mt-1 m-0">Show last hour values</p>
                                </div><!-- /.card-left -->

                                <!--<div class="card-right float-right text-right">
                                  <i class="icon fade-5 icon-lg fa fa-thermometer-three-quarters"></i>
                                </div>--><!-- /.card-right -->

                            </div>

                        </div>
                    </div>
                    <!--/.col-->

                    <div class="col-sm-6 col-lg-4">
                        <div class="card text-white bg-flat-color-2 clickable-card">
                            <div class="card-body">
                                <div class="card-left pt-1 float-left">
                                    <h3 class="mb-0 fw-r">Wind direction</h3>
                                    <p class="text-light mt-1 m-0">Show last hour values</p>
                                </div><!-- /.card-left -->

                                <!--<div class="card-right float-right text-right">
                                    <i class="icon fade-5 icon-lg pe-7s-users"></i>
                                </div>--><!-- /.card-right -->

                            </div>

                        </div>
                    </div>
                    <!--/.col-->

                    <div class="col-sm-6 col-lg-4">
                        <div class="card text-white bg-flat-color-4 clickable-card">
                            <div class="card-body">
                                <div class="card-left pt-1 float-left">
                                    <h3 class="mb-0 fw-r">Wind intensity</h3>
                                    <p class="text-light mt-1 m-0">Show last hour values</p>
                                </div><!-- /.card-left -->

                                <div class="card-right float-right text-right">
                                    <div id="flotLine1" class="flotLine1"></div>
                                </div><!-- /.card-right -->

                            </div>

                        </div>
                    </div>
                    <!--/.col-->

                    <div class="col-sm-6 col-lg-4">
                        <div class="card text-white bg-flat-color-3 clickable-card">
                            <div class="card-body">
                              <div class="card-left pt-1 float-left">
                                    <h3 class="mb-0 fw-r">Rain height</h3>
                                    <p class="text-light mt-1 m-0">Show last hour values</p>
                                </div><!-- /.card-left -->

                                <div class="card-right float-right text-right">
                                    <div id="flotLine1" class="flotLine1"></div>
                                </div><!-- /.card-right -->

                            </div>
                        </div>
                    </div>
                    <!--/.col-->

                </div>
                <!-- /Widgets -->

                <!-- Just for smooth scrolling properly -->
                <div id="history-chart-pos-for-scrolling" class="card-body"><br></div>

                <!-- Line Chart -->
                <!--<div id="history-chart" class="row" >
                  <div class="col-xl-8">
                    <div class="card">
                      <div class="card-body">-->
                        <!-- Card header -->
                        <!--<div class="stat-widget-five">
                          <div class="stat-icon dib flat-color-3">
                            <i class="pe-7s-graph2"></i>
                          </div>
                          <div class="stat-content">
                            <div class="text-left dib">
                                <div class="stat-text"><span>History Chart</span></div>
                                <div id="stationId-history" class="stat-heading">stationId</div>
                            </div>
                          </div>
                        </div>-->
                        <!-- /Card header -->
                        <!--<canvas id="historyChart"></canvas>
                      </div>-->
                      <!--<div id="real-time-pos-for-scrolling" class="card-body"></div>--> <!-- Just for scrolling properly -->
                    <!--</div>
                  </div>
                </div>-->
                <!-- /Line Chart -->

                <div id="history-charts"></div>

                <!-- Just for smooth scrolling properly -->
                <div id="real-time-pos-for-scrolling" class="card-body"></div>

                <!-- Real Chart -->
                <div id="real-time" class="row" >
                  <div class="col-xl-8">
                  <!--<div class="col-lg-6">-->
                    <div class="card">
                      <div class="card-body">
                          <!-- Card header -->
                          <div class="stat-widget-five">
                            <div class="stat-icon dib flat-color-1">
                              <i class="ti-pulse"></i>
                            </div>
                            <div class="stat-content">
                              <div class="text-left dib">
                                  <div class="stat-text"><span>Real Time</span></div>
                                  <div id="stationId-real-time" class="stat-heading">StationId</div>
                              </div>
                            </div>
                          </div>
                          <!-- /Card header -->
                          <!-- Card body -->
                          <div class="progress-box progress-1">
                              <h4 class="por-title">Temperature</h4>
                              <div id="temperature-real-time" class="por-txt"></div>
                              <div class="progress mb-2" style="height: 5px;">
                                  <div id="temperature-real-time-progress" class="progress-bar bg-flat-color-1" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="-50" aria-valuemax="50"></div>
                              </div>
                          </div>
                          <div class="progress-box progress-2">
                              <h4 class="por-title">Humidity</h4>
                              <div id="humidity-real-time" class="por-txt"></div>
                              <div class="progress mb-2" style="height: 5px;">
                                  <div id="humidity-real-time-progress" class="progress-bar bg-flat-color-6" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                              </div>
                          </div>
                          <div class="progress-box progress-2">
                              <h4 class="por-title">Wind direction</h4>
                              <div id="windDirection-real-time" class="por-txt"></div>
                              <div class="progress mb-2" style="height: 5px;">
                                  <div id="windDirection-real-time-progress" class="progress-bar bg-flat-color-2" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="360"></div>
                              </div>
                          </div>
                          <div class="progress-box progress-2">
                              <h4 class="por-title">Wind intensity</h4>
                              <div id="windIntensity-real-time" class="por-txt"></div>
                              <div class="progress mb-2" style="height: 5px;">
                                  <div id="windIntensity-real-time-progress" class="progress-bar bg-flat-color-4" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                              </div>
                          </div>
                          <div class="progress-box progress-2">
                              <h4 class="por-title">Rain height</h4>
                              <div id="rainHeight-real-time" class="por-txt"></div>
                              <div class="progress mb-2" style="height: 5px;">
                                  <div id="rainHeight-real-time-progress" class="progress-bar bg-flat-color-3" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="50"></div>
                              </div>
                          </div>
                          <!-- /Card body -->
                      </div>
                    </div>
                  </div>
                </div>
                <!-- /Real Chart -->

                <!-- /.orders -->
                <!-- To Do and Live Chat -->
                <!--<div class="row">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title box-title">To Do List</h4>
                                <div class="card-content">
                                    <div class="todo-list">
                                        <div class="tdl-holder">
                                            <div class="tdl-content">
                                                <ul>
                                                    <li>
                                                        <label>
                                                            <input type="checkbox"><i class="check-box"></i><span>Conveniently fabricate interactive technology for ....</span>
                                                            <a href='#' class="fa fa-times"></a>
                                                            <a href='#' class="fa fa-pencil"></a>
                                                            <a href='#' class="fa fa-check"></a>
                                                        </label>
                                                    </li>
                                                    <li>
                                                        <label>
                                                            <input type="checkbox"><i class="check-box"></i><span>Creating component page</span>
                                                            <a href='#' class="fa fa-times"></a>
                                                            <a href='#' class="fa fa-pencil"></a>
                                                            <a href='#' class="fa fa-check"></a>
                                                        </label>
                                                    </li>
                                                    <li>
                                                        <label>
                                                            <input type="checkbox" checked><i class="check-box"></i><span>Follow back those who follow you</span>
                                                            <a href='#' class="fa fa-times"></a>
                                                            <a href='#' class="fa fa-pencil"></a>
                                                            <a href='#' class="fa fa-check"></a>
                                                        </label>
                                                    </li>
                                                    <li>
                                                        <label>
                                                            <input type="checkbox" checked><i class="check-box"></i><span>Design One page theme</span>
                                                            <a href='#' class="fa fa-times"></a>
                                                            <a href='#' class="fa fa-pencil"></a>
                                                            <a href='#' class="fa fa-check"></a>
                                                        </label>
                                                    </li>

                                                    <li>
                                                        <label>
                                                            <input type="checkbox" checked><i class="check-box"></i><span>Creating component page</span>
                                                            <a href='#' class="fa fa-times"></a>
                                                            <a href='#' class="fa fa-pencil"></a>
                                                            <a href='#' class="fa fa-check"></a>
                                                        </label>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>--> <!-- /.todo-list -->
                                <!--</div>
                            </div>--> <!-- /.card-body -->
                        <!--</div>--><!-- /.card -->
                    <!--</div>-->

                    <!--<div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title box-title">Live Chat</h4>
                                <div class="card-content">
                                    <div class="messenger-box">
                                        <ul>
                                            <li>
                                                <div class="msg-received msg-container">
                                                    <div class="avatar">
                                                       <img src="images/avatar/64-1.jpg" alt="">
                                                       <div class="send-time">11.11 am</div>
                                                    </div>
                                                    <div class="msg-box">
                                                        <div class="inner-box">
                                                            <div class="name">
                                                                John Doe
                                                            </div>
                                                            <div class="meg">
                                                                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Perspiciatis sunt placeat velit ad reiciendis ipsam
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>--><!-- /.msg-received -->
                                            <!--</li>
                                            <li>
                                                <div class="msg-sent msg-container">
                                                    <div class="avatar">
                                                       <img src="images/avatar/64-2.jpg" alt="">
                                                       <div class="send-time">11.11 am</div>
                                                    </div>
                                                    <div class="msg-box">
                                                        <div class="inner-box">
                                                            <div class="name">
                                                                John Doe
                                                            </div>
                                                            <div class="meg">
                                                                Hay how are you doing?
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>--><!-- /.msg-sent -->
                                            <!--</li>
                                        </ul>
                                        <div class="send-mgs">
                                            <div class="yourmsg">
                                                <input class="form-control" type="text">
                                            </div>
                                            <button class="btn msg-send-btn">
                                                <i class="pe-7s-paper-plane"></i>
                                            </button>
                                        </div>
                                    </div>--><!-- /.messenger-box -->
                                <!--</div>
                            </div>--> <!-- /.card-body -->
                        <!--</div>--><!-- /.card -->
                    <!--</div>
                </div>-->
                <!-- /To Do and Live Chat -->
                <!-- Calender Chart Weather  -->
                <!--<div class="row">
                    -<div class="col-md-12 col-lg-4">
                        <div class="card">
                            <div class="card-body">-->
                                <!-- <h4 class="box-title">Chandler</h4> -->
                                <!--<div class="calender-cont widget-calender">
                                    <div id="calendar"></div>
                                </div>
                            </div>
                        </div>--><!-- /.card -->
                    <!--</div>-->

                    <!--<div class="col-lg-4 col-md-6">
                        <div class="card ov-h">
                            <div class="card-body bg-flat-color-2">
                                <div id="flotBarChart" class="float-chart ml-4 mr-4"></div>
                            </div>
                            <div id="cellPaiChart" class="float-chart"></div>
                        </div>--><!-- /.card -->
                    <!--</div>-->
                    <!--<div class="col-lg-4 col-md-6">
                        <div class="card weather-box">
                            <h4 class="weather-title box-title">Weather</h4>
                            <div class="card-body">
                                <div class="weather-widget">
                                    <div id="weather-one" class="weather-one"></div>
                                </div>
                            </div>
                        </div>--><!-- /.card -->
                    <!--</div>
                </div>-->
                <!-- /Calender Chart Weather -->
                <!-- Modal - Calendar - Add New Event -->
              <!--  <div class="modal fade none-border" id="event-modal">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title"><strong>Add New Event</strong></h4>
                            </div>
                            <div class="modal-body"></div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-success save-event waves-effect waves-light">Create event</button>
                                <button type="button" class="btn btn-danger delete-event waves-effect waves-light" data-dismiss="modal">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>-->
                <!-- /#event-modal -->
                <!-- Modal - Calendar - Add Category -->
                <!--<div class="modal fade none-border" id="add-category">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title"><strong>Add a category </strong></h4>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="control-label">Category Name</label>
                                            <input class="form-control form-white" placeholder="Enter name" type="text" name="category-name"/>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="control-label">Choose Category Color</label>
                                            <select class="form-control form-white" data-placeholder="Choose a color..." name="category-color">
                                                <option value="success">Success</option>
                                                <option value="danger">Danger</option>
                                                <option value="info">Info</option>
                                                <option value="pink">Pink</option>
                                                <option value="primary">Primary</option>
                                                <option value="warning">Warning</option>
                                            </select>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-danger waves-effect waves-light save-category" data-dismiss="modal">Save</button>
                            </div>
                        </div>
                    </div>
                </div>-->
            <!-- /#add-category -->

            <!--h2>TEXTAREA</h2>
            <textarea readonly id= "textarea" style="width:400px; height:800px"></textarea>-->

            </div>
            <!-- .animated -->
        </div>
        <!-- /.content -->
        <div class="clearfix"></div>
        <!-- Footer -->
        <footer class="site-footer">
            <div class="footer-inner bg-white">
                <div class="row">
                    <div class="col-sm-6">
                        Copyright &copy;<script>document.write(new Date().getFullYear());</script> Ela Admin
                    </div>
                    <div class="col-sm-6 text-right">
                        Designed by <a href="https://colorlib.com">Colorlib</a>
                    </div>
                </div>
            </div>
        </footer>
        <!-- /.site-footer -->
    </div>
    <!-- /#right-panel -->

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-match-height@0.7.2/dist/jquery.matchHeight.min.js"></script>
    <script src="assets/js/main.js"></script>

    <!--  Chart js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.7.3/dist/Chart.bundle.min.js"></script>
    <!-- For Real time pulse graph -->
    <!--<script src="assets/js/init/flot-chart-init.js"></script>-->

    <!--Chartist Chart-->
    <script src="https://cdn.jsdelivr.net/npm/chartist@0.11.0/dist/chartist.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartist-plugin-legend@0.6.2/chartist-plugin-legend.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/jquery.flot@0.8.3/jquery.flot.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flot-pie@1.0.0/src/jquery.flot.pie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flot-spline@0.0.1/js/jquery.flot.spline.min.js"></script>

    <!--<script src="https://cdn.jsdelivr.net/npm/simpleweather@3.1.0/jquery.simpleWeather.min.js"></script>
    <script src="assets/js/init/weather-init.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@3.9.0/dist/fullcalendar.min.js"></script>
    <script src="assets/js/init/fullcalendar-init.js"></script>-->

    <!-- For AWS DynamoDB -->
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.7.16.min.js"></script>

    <!--Local Stuff-->
    <script>
        jQuery(document).ready(function($) {
            "use strict";

            // My additions
            // At the beginning hide all the charts
            $('#real-time').hide();
            //$('#history-chart').hide();

            // Global variables
            var updateInterval = 5000; //milliseconds
            var updateIntervalInSeconds = 5;
            var realTimeStationId = null;


            /*AWS.config.update({
              region: "us-east-1",
              //endpoint: "https://dynamodb.us-east-1.amazonaws.com",

              // accessKeyId default can be used while using the downloadable version of DynamoDB.
              // For security reasons, do not store AWS Credentials in your files. Use Amazon Cognito instead.
              accessKeyId: "",
              // secretAccessKey default can be used while using the downloadable version of DynamoDB.
              // For security reasons, do not store AWS Credentials in your files. Use Amazon Cognito instead.
              secretAccessKey: ""
            });//*/

            // Initialize Amazon Cognito credentials provider
            AWS.config.region = 'us-east-1';
            AWS.config.credentials = new AWS.CognitoIdentityCredentials({
                IdentityPoolId: 'us-east-1:daa17eed-ea6f-4b56-8eba-1ef0acc52774',
            });//*/

            var docClient = new AWS.DynamoDB.DocumentClient();
            getAllStationsFromDB();
            //getLastHourDataFromDB("temperature");

            // Just for testing
            /*var data = [
              ["#4322", "Online"],
              ["#4323", "Offline"],
              ["#4324", "Online"],
              ["#4325", "Online"],
              ["#4326", "Offline"],
              ["#4327", "Offline"],
              ["#4328", "Online"],
            ];
            populateTable("#stations-table-body", data, data.length);

            updateRealTimeProgressBars([35, 22, 180, 32, 23]);//*/

            // IT DOES NOT WORK WITH DB ELEMENTS, READ BELOW
            /*$(".clickable-row").click(function(){
              $('#real-time').show();
              var stationId = ($(this).children()[2]).innerHTML;
              $("#stationId-real-time").text(stationId);
              window.location = "#real-time-pos-for-scrolling";
            });*/

            // IT DOES NOT WORK WITH DB ELEMENTS, READ BELOW
            /*$('.clickable-row').on('click', function() {
              $('#real-time').show();
              var stationId = ($(this).children()[2]).innerHTML;
              $("#stationId-real-time").text(stationId);
              window.location = "#real-time-pos-for-scrolling";
            });*/

            // JQuery OnClick Method is bound to an element or selector on page ready/load.
            // Therefore if that element you want to click isn’t there at the time of page ready,
            // the binding can’t happen.
            // The fix is easy enough, simply bind the OnClick event to the parent of the elements
            // you want to be able to click on.
            $("#stations-table-body").delegate(".clickable-row", "click", function(){
              $('#real-time').show();
              var stationId = ($(this).children()[2]).innerHTML;

              // If user click the same station, the card is closed, then stop to query the DB
              if(realTimeStationId == stationId) {
                realTimeStationId = null;
                $('#real-time').hide();
                return;
              }

              $("#stationId-real-time").text(stationId);
              window.location = "#real-time-pos-for-scrolling";

              /*if ($("#real-time-pos-for-scrolling").is(":visible"))
                window.location = "#real-time-pos-for-scrolling";
              else
                window.location = "#history-chart-pos-for-scrolling";*/

              realTimeStationId = stationId;
              getRealTimeDataFromDB(stationId);
            });

            $(".clickable-card").click(function(){
              //$('#history-chart').show();
              var sensor = $(this).find("h3").text();

              // Set a timeout waiting for the creation of the new elements
              setTimeout(function() {
                  window.location = "#history-chart-pos-for-scrolling";
              },
              500);

              getLastHourDataFromDB(sensor);
            });

            // Populate a table specifying the id, the data and the amount of them.
            // Data is an array of arrays [["id", "status"], ..., [...]]
            function populateTable(tableId, data, amount) {
              // Example of data
              /*var data = [
                ["#4322", "Online"],
                ["#4322", "Offline"]
              ];*/

              var stations_number_element = $("#stations_number");
              stations_number_element.text(amount);
              stations_number_element.addClass("count");

              for (var i=0; i<amount; i++){
                // Returns a random integer from 0 to 9
                var random = Math.floor(Math.random() * 10);

                if (data[i][1] == "Online")
                  $(tableId).append("<tr class='clickable-row'><td class='serial'>"+(i+1)+".</td><td class='avatar'><div class='round-img'><a href='#'><img class='rounded-circle' src='images/avatar/avatar"+random+".png' alt=''></a></div></td><td>"+data[i][0]+"</td><td><span class='badge badge-complete'>"+data[i][1]+"</span></td></tr>");
                else
                  $(tableId).append("<tr class='clickable-row'><td class='serial'>"+(i+1)+".</td><td class='avatar'><div class='round-img'><a href='#'><img class='rounded-circle' src='images/avatar/avatar"+random+".png' alt=''></a></div></td><td>"+data[i][0]+"</td><td><span class='badge badge-danger'>"+data[i][1]+"</span></td></tr>");


                  // In this way doesn't appear properly
                  /*$("#stations-table-body").append(""+
                    +"<tr>"
                    +    "<td class='serial'>3.</td>"
                    +    "<td class='avatar'>"
                    +      "<div class='round-img'>"
                    +        "<a href='#'><img class='rounded-circle' src='images/avatar/avatar3.png' alt=''></a>"
                    +      "</div>"
                    +    "</td>"
                    +    "<td> #5467 </td>"
                    +    "<td>"
                    +      "<span class='badge badge-complete'>Online</span>"
                    +    "</td>"
                    +"</tr>"
                  );*/
              }
            }

            // Scan the DB to get all stations
            function getAllStationsFromDB() {
              console.log("Scanning Stations table..\n.");
              //document.getElementById('textarea').innerHTML += "Scanning Stations table..." + "\n";

              var params = {
                  TableName : "VirtualEnvironmentStationsDB",
                  ProjectionExpression: "Id, #dt",
                  ExpressionAttributeNames:{
                      "#dt": "dateTime"
                  }
              };

              docClient.scan(params, onScan);

              function onScan(err, data) {
                  if (err) {
                      console.log("Unable to scan the table: " + "\n" + JSON.stringify(err, undefined, 2));
                      //document.getElementById('textarea').innerHTML += "Unable to scan the table: " + "\n" + JSON.stringify(err, undefined, 2);
                  } else {
                      // Print all the stations
                      console.log("Scanning succeeded.\n");
                      //document.getElementById('textarea').innerHTML += "Scan succeeded. " + "\n";
                      var map = new Map();

                      data.Items.forEach(function(station) {
                          //document.getElementById('textarea').innerHTML += station.Id + " " + station.dateTime + "\n";
                          // DynamoDB scan the DB from first inserted entry to last so the Last
                          // valued set is the most recent
                          map.set(station.Id, station.dateTime);
                      });

                      // Continue scanning if we have more movies (per scan 1MB limitation)
                      if (typeof data.LastEvaluatedKey != "undefined") {
                          //console.log("Scanning for more...");
                          //document.getElementById('textarea').innerHTML += "Scanning for more...";
                          params.ExclusiveStartKey = data.LastEvaluatedKey;
                          docClient.scan(params, onScan);
                      }

                      // Prepare data for the table
                      var stations_number = 0;
                      var stations = [];    // Array of arrays
                      var dateTimes = getDateTime();
                      var now = dateTimes[0];
                      var dateTimeOneIntervalAgo = dateTimes[2];

                      //alert(now);
                      //alert(dateTimeOneIntervalAgo);

                      for (let [key, value] of map.entries()) {
                        //console.log('key is ' + key + ', value is ' + value);
                        //console.log('now: ' + now);
                        //console.log('dateTimeOneIntervalAgo ' + dateTimeOneIntervalAgo);

                        // Check current status
                        if (isDateTimeInRange(value, dateTimeOneIntervalAgo, now))
                          stations.push([key, "Online"]);
                        else
                          stations.push([key, "Offline"]);

                        stations_number++;
                      }

                      populateTable("#stations-table-body", stations, stations_number);
                  }
              }

            }

            // Query the DB to get real time data from a station
            function getRealTimeDataFromDB(stationId=realTimeStationId) {
              if(stationId == null)
                return null;

              console.log("Querying for real time data of "+ stationId +"...\n");
              //document.getElementById('textarea').innerHTML += "Querying for real time data of "+stationId+"...\n";

              var params = {
                  TableName : "VirtualEnvironmentStationsDB",
                  ProjectionExpression: "Id, #dt, Payload",
                  KeyConditionExpression: "Id = :stationId",
                  ExpressionAttributeNames:{
                      "#dt": "dateTime"
                  },
                  ExpressionAttributeValues: {
                      ":stationId": stationId
                  }
              };

              docClient.query(params, function(err, data) {
                  if (err) {
                      console.log("Unable to query. Error:\n" + JSON.stringify(err, undefined, 2));
                      //document.getElementById('textarea').innerHTML += "Unable to query. Error: " + "\n" + JSON.stringify(err, undefined, 2);
                  } else {
                      console.log("Querying succeeded.\n");
                      //document.getElementById('textarea').innerHTML += "Querying succeeded.\n";

                      var payload = null;
                      data.Items.forEach(function(station) {
                          payload = station.Payload;
                          //document.getElementById('textarea').innerHTML += station.Id + " " + station.dateTime
                            //+ "\ntemperature: " + payload.temperature
                            //+ "\nhumidity: " + payload.humidity + "\n";
                          // DynamoDB scan the DB from first inserted entry to last one
                      });

                      if (payload != null)
                        updateRealTimeProgressBars([payload.temperature, payload.humidity, payload.windDirection, payload.windIntensity, payload.rainHeight]);
                  }
              });

            }

            // Return current dateTime, the dateTime of 1 hour ago and
            // the dateTime of 1 station interval of sending ago
            function getDateTime() {
              var now     = new Date();
              var year    = now.getFullYear();
              var month   = now.getMonth()+1;
              var day     = now.getDate();
              var hour    = now.getHours();
              var minute  = now.getMinutes();
              var second  = now.getSeconds();

              month = getTwoDigits(month);
              day = getTwoDigits(day);
              hour = getTwoDigits(hour);
              minute = getTwoDigits(minute);
              second = getTwoDigits(second);

              var dateTime = day+'-'+month+'-'+year+' '+hour+':'+minute+':'+second;
              var dateTimeOneHourAgo = "";
              var dateTimeOneIntervalAgo = "";
              var tolerance = 3;      // Tolerance in seconds for the temporal window
              var updateIntervalInSecondsWithTolerance = updateIntervalInSeconds + tolerance;

              if(hour == 0)
                dateTimeOneHourAgo = getTwoDigits(day-1)+'-'+month+'-'+year+' 23:'+minute+':'+second;
              else
                dateTimeOneHourAgo = day+'-'+month+'-'+year+' '+getTwoDigits(hour-1)+':'+minute+':'+second;

              // Assume updateIntervalInSecondsWithTolerance < 60, +second convert the string into a number
              if(second < updateIntervalInSecondsWithTolerance)
                dateTimeOneIntervalAgo = day+'-'+month+'-'+year+' '+hour+':'+getTwoDigits(minute-1)+':'+getTwoDigits(60 + +second - updateIntervalInSecondsWithTolerance);
              else
                dateTimeOneIntervalAgo = day+'-'+month+'-'+year+' '+hour+':'+minute+':'+getTwoDigits(second-updateIntervalInSecondsWithTolerance);

              return [dateTime, dateTimeOneHourAgo, dateTimeOneIntervalAgo];
            }

            // Return a two digits string (assuming I pass only positive values of at most two digits)
            function getTwoDigits(number) {
              if(number < 10 && number.toString().length == 1)
                return '0' + number;
              else
                return number;
            }

            // create equivalent Date object from the string 'dd-mm-yyyy hh:mm:ss'
            // e.g. 25-03-2020 16:53:41 => equivalent Date obj
            function convertDateTimeToDate(dateTime) {
              var day = dateTime.substr(0,2);
              var month = dateTime.substr(3,2) - 1;
              var year = dateTime.substr(6,4);
              var hours = dateTime.substr(11,2);
              var minutes = dateTime.substr(14,2);
              var seconds = dateTime.substr(17,2);

              return new Date(year, month, day, hours, minutes, seconds)
            }

            // Check if a dateTime is between dateTimes in start and end
            function isDateTimeInRange(dateTime, start, end) {
              var d = convertDateTimeToDate(dateTime);
              var s = convertDateTimeToDate(start);
              var e = convertDateTimeToDate(end);

              //console.log("dateTime: " + d + "\n");
              //console.log("start: " + s + "\n");
              //console.log("end: " + e + "\n");
              //console.log("s <= d && d <= e ? " + (s <= d && d <= e) + "\n");

              return s <= d && d <= e;
            }

            // Substitute all spaces with the UpperCase of the next char and remove the duplicate
            // e.g wind direction => windDirection
            function createVariableName(string) {
              // Remove whitespace from both sides of a string and
              // convert the string to lowercase letters
              string = string.trim().toLowerCase();

              for (var i=0; i < string.length; i++) {
                // Doesn't throw exception since I used trim()
                if (string.charAt(i) == " ") {
                  // The substr() method extracts parts of a string,
                  // beginning at the character at the specified position,
                  // and returns the specified number of characters.
                  string = string.substr(0, i) + string.charAt(i+1).toUpperCase() + string.substr(i+2);
                }
              }

              return string;
            }

            // Query the DB to get values received during the last hour from all environmental station
            // of a specified sensor
            // Se non funziona between allora usare formato data 2015-12-21T17:42:34Z
            function getLastHourDataFromDB(sensor) {
                sensor = createVariableName(sensor);

                console.log("Querying for last hour " + sensor +" values from all environmental station...\n");
                //document.getElementById('textarea').innerHTML += "Querying for last hour " + sensor +" values from all environmental station...\n";

                var dateTime = getDateTime();
                var params = {
                  TableName : "VirtualEnvironmentStationsDB",
                  ProjectionExpression: "Id, #dt, Payload", //."+sensor,
                  ExpressionAttributeNames:{
                      "#dt": "dateTime"
                  },
                  FilterExpression: "#dt between :start_h and :end_h", //and Payload."+sensor+" = :sensor",
                  ExpressionAttributeValues: {
                      ":start_h": dateTime[1],
                      ":end_h": dateTime[0],
                  }
                };

                docClient.scan(params, onScan);

                function onScan(err, data) {
                    if (err) {
                        console.log("Unable to scan the table: " + "\n" + JSON.stringify(err, undefined, 2));
                        //document.getElementById('textarea').innerHTML += "Unable to scan the table: " + "\n" + JSON.stringify(err, undefined, 2);
                    } else {
                        // Print all the stations
                        console.log("Scanning succeeded.\n");
                        //document.getElementById('textarea').innerHTML += "Scan succeeded. " + "\n";

                        // Map where to store station objects
                        var stations = new Map();

                        data.Items.forEach(function(stationData) {
                            //document.getElementById('textarea').innerHTML += stationData.Id + "\n"
                            //                                        + stationData.dateTime + "\n"
                            //                                        + stationData.Payload[sensor] + "\n";

                            // DynamoDB scan the DB from first inserted entry to last one

                            //console.log(station.sensorValues + "\n" + station.dateTimes+ "\n" );

                            var value = stations.get(stationData.Id);

                            if (value == undefined) {
                              // Object to associate each stationId with two array of values
                              var station = {id:"", sensorValues:[], dateTimes:[]};

                              station.sensorValues.push(stationData.Payload[sensor]);
                              station.dateTimes.push(stationData.dateTime);
                              stations.set(stationData.Id, station);
                            }
                            else {
                              value.sensorValues.push(stationData.Payload[sensor]);
                              value.dateTimes.push(stationData.dateTime);
                            }
                        });

                        // Continue scanning if we have more data (per scan 1MB limitation)
                        if (typeof data.LastEvaluatedKey != "undefined") {
                            //console.log("Scanning for more...");
                            //document.getElementById('textarea').innerHTML += "Scanning for more...";
                            params.ExclusiveStartKey = data.LastEvaluatedKey;
                            docClient.scan(params, onScan);
                        }

                        // Clean area where to put the new charts
                        var area = $("#history-charts");
                        area.html("");

                        // Draw a chart for each station
                        for (let [key, value] of stations.entries()) {
                          //console.log('key is ' + key + ', value is ' + value);
                          createCardForChart(area, key);
                          drawLineChart(key, sensor, value.dateTimes, value.sensorValues);
                        }
                    }
                }

            }

            // Updates the text and the progressbar with the new value
            function updateProgressBar(textId, progressbarId, value, measureUnit="", showPercentage=false) {
              var progressbar = $(progressbarId);
              var minValue = progressbar.attr("aria-valuemin");
              var perc = 0;

              if (minValue == 0)
                perc = (value / progressbar.attr("aria-valuemax")) * 100;
              // Translate to center in zero
              else if (minValue < 0)
                perc = ((value+Math.abs(minValue)) / (+(progressbar.attr("aria-valuemax"))+Math.abs(minValue))) * 100;
              else
                perc = ((value-Math.abs(minValue)) / (+(progressbar.attr("aria-valuemax"))-Math.abs(minValue))) * 100;

              perc = Math.floor(perc * 100) / 100;    // Return only 2 decimal digits

              progressbar.css("width", perc + "%");
              progressbar.attr("aria-valuenow", value);

              if (showPercentage)
                $(textId).text(value + " " + measureUnit + " (" + perc + "%)");
              else
                $(textId).text(value + measureUnit);
            }

            // Update real time progress bars with new data as array
            function updateRealTimeProgressBars(data) {
              updateProgressBar("#temperature-real-time", "#temperature-real-time-progress", data[0], "°C", true);
              updateProgressBar("#humidity-real-time", "#humidity-real-time-progress", data[1], "%");
              updateProgressBar("#windDirection-real-time", "#windDirection-real-time-progress", data[2], "degrees", true);
              updateProgressBar("#windIntensity-real-time", "#windIntensity-real-time-progress", data[3], "m/s", true);
              updateProgressBar("#rainHeight-real-time", "#rainHeight-real-time-progress", data[4], "mm/h", true);

              if (realTimeStationId != null)
                setTimeout(getRealTimeDataFromDB, updateInterval);
            }

            function createCardForChart(area, stationId) {
              area.append("<div id='history-chart"+stationId+"' class='row'><div class='col-xl-8'><div class='card'><div class='card-body'><div class='stat-widget-five'><div class='stat-icon dib flat-color-3'><i class='pe-7s-graph2'></i></div><div class='stat-content'><div class='text-left dib'><div class='stat-text'><span>History Chart</span></div><div class='stat-heading'>"+stationId+"</div></div></div></div><canvas id='historyChart"+stationId+"'></canvas></div></div></div></div>");

              /*<!-- Line Chart -->
              <div id="history-chart" class="row" >
                <div class="col-xl-8">
                  <div class="card">
                    <div class="card-body">
                      <!-- Card header -->
                      <div class="stat-widget-five">
                        <div class="stat-icon dib flat-color-3">
                          <i class="pe-7s-graph2"></i>
                        </div>
                        <div class="stat-content">
                          <div class="text-left dib">
                              <div class="stat-text"><span>History Chart</span></div>
                              <div id="stationId-history" class="stat-heading">stationId</div>
                          </div>
                        </div>
                      </div>
                      <!-- /Card header -->
                      <canvas id="historyChart"></canvas>
                    </div>
                    <div id="real-time-pos-for-scrolling" class="card-body"></div> <!-- Just for scrolling properly -->
                  </div>
                </div>
              </div>
              <!-- /Line Chart -->*/

            }


            function drawLineChart(stationId, sensor, labelValues, dataValues) {
              var color = "";

              switch(sensor) {
                case "temperature":
                  color = "#00c292";
                  break;
                case "humidity":
                  color = "#5c6bc0";
                  break;
                case "windDirection":
                  color = "#ab8ce4";
                  break;
                case "windIntensity":
                  color = "#fb9678";
                  break;
                case "rainHeight":
                  color = "#03a9f3";
                  break;
                default:
                  color = 'rgb(255, 99, 132)';
              }

              //alert(labelValues);
              //alert(dataValues);

              //var canvas = $('historyChart'+stationId);
              var canvas = document.getElementById('historyChart'+stationId);
              var ctx = canvas.getContext('2d');
              // Clear the canvas
              ctx.clearRect(0, 0, canvas.width, canvas.height);
              var chart = new Chart(ctx, {
                  // The type of chart we want to create
                  type: 'line',

                  // The data for our dataset
                  data: {
                      labels: labelValues, //['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September'],
                      datasets: [{
                          label: sensor,
                          backgroundColor: color,
                          borderColor: color,
                          data: dataValues //[0, 10, 5, 2, 20, 30, 45, 35, 50]
                      }]
                  },

                  // Configuration options go here
                  options: {
                    /*animation: {
                        onProgress: function(animation) {
                            progress.value = animation.animationObject.currentStep / animation.animationObject.numSteps;
                        }
                    }*/
                  }

              });
            }








            // Pie chart flotPie1
            /*var piedata = [
                { label: "Desktop visits", data: [[1,32]], color: '#5c6bc0'},
                { label: "Tab visits", data: [[1,33]], color: '#ef5350'},
                { label: "Mobile visits", data: [[1,35]], color: '#66bb6a'}
            ];

            $.plot('#flotPie1', piedata, {
                series: {
                    pie: {
                        show: true,
                        radius: 1,
                        innerRadius: 0.65,
                        label: {
                            show: true,
                            radius: 2/3,
                            threshold: 1
                        },
                        stroke: {
                            width: 0
                        }
                    }
                },
                grid: {
                    hoverable: true,
                    clickable: true
                }
            });*/
            // Pie chart flotPie1  End
            // cellPaiChart
            /*var cellPaiChart = [
                { label: "Direct Sell", data: [[1,65]], color: '#5b83de'},
                { label: "Channel Sell", data: [[1,35]], color: '#00bfa5'}
            ];
            $.plot('#cellPaiChart', cellPaiChart, {
                series: {
                    pie: {
                        show: true,
                        stroke: {
                            width: 0
                        }
                    }
                },
                legend: {
                    show: false
                },grid: {
                    hoverable: true,
                    clickable: true
                }

            });*/
            // cellPaiChart End
            // Line Chart  #flotLine5
            /*var newCust = [[0, 3], [1, 5], [2,4], [3, 7], [4, 9], [5, 3], [6, 6], [7, 4], [8, 10]];

            var plot = $.plot($('#flotLine5'),[{
                data: newCust,
                label: 'New Data Flow',
                color: '#fff'
            }],
            {
                series: {
                    lines: {
                        show: true,
                        lineColor: '#fff',
                        lineWidth: 2
                    },
                    points: {
                        show: true,
                        fill: true,
                        fillColor: "#ffffff",
                        symbol: "circle",
                        radius: 3
                    },
                    shadowSize: 0
                },
                points: {
                    show: true,
                },
                legend: {
                    show: false
                },
                grid: {
                    show: false
                }
            });*/
            // Line Chart  #flotLine5 End
            // Traffic Chart using chartist
            if ($('#traffic-chart').length) {
                var chart = new Chartist.Line('#traffic-chart', {
                  labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                  series: [
                  [0, 18000, 35000,  25000,  22000,  0],
                  [0, 33000, 15000,  20000,  15000,  300],
                  [0, 15000, 28000,  15000,  30000,  5000]
                  ]
              }, {
                  low: 0,
                  showArea: true,
                  showLine: false,
                  showPoint: false,
                  fullWidth: true,
                  axisX: {
                    showGrid: true
                }
            });

                chart.on('draw', function(data) {
                    if(data.type === 'line' || data.type === 'area') {
                        data.element.animate({
                            d: {
                                begin: 2000 * data.index,
                                dur: 2000,
                                from: data.path.clone().scale(1, 0).translate(0, data.chartRect.height()).stringify(),
                                to: data.path.clone().stringify(),
                                easing: Chartist.Svg.Easing.easeOutQuint
                            }
                        });
                    }
                });
            }
            // Traffic Chart using chartist End
            //Traffic chart chart-js
            if ($('#TrafficChart').length) {
                var ctx = document.getElementById( "TrafficChart" );
                ctx.height = 150;
                var myChart = new Chart( ctx, {
                    type: 'line',
                    data: {
                        labels: [ "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul" ],
                        datasets: [
                        {
                            label: "Visit",
                            borderColor: "rgba(4, 73, 203,.09)",
                            borderWidth: "1",
                            backgroundColor: "rgba(4, 73, 203,.5)",
                            data: [ 0, 2900, 5000, 3300, 6000, 3250, 0 ]
                        },
                        {
                            label: "Bounce",
                            borderColor: "rgba(245, 23, 66, 0.9)",
                            borderWidth: "1",
                            backgroundColor: "rgba(245, 23, 66,.5)",
                            pointHighlightStroke: "rgba(245, 23, 66,.5)",
                            data: [ 0, 4200, 4500, 1600, 4200, 1500, 4000 ]
                        },
                        {
                            label: "Targeted",
                            borderColor: "rgba(40, 169, 46, 0.9)",
                            borderWidth: "1",
                            backgroundColor: "rgba(40, 169, 46, .5)",
                            pointHighlightStroke: "rgba(40, 169, 46,.5)",
                            data: [1000, 5200, 3600, 2600, 4200, 5300, 0 ]
                        }
                        ]
                    },
                    options: {
                        responsive: true,
                        tooltips: {
                            mode: 'index',
                            intersect: false
                        },
                        hover: {
                            mode: 'nearest',
                            intersect: true
                        }

                    }
                } );
            }
            //Traffic chart chart-js  End
            // Bar Chart #flotBarChart
            /*$.plot("#flotBarChart", [{
                data: [[0, 18], [2, 8], [4, 5], [6, 13],[8,5], [10,7],[12,4], [14,6],[16,15], [18, 9],[20,17], [22,7],[24,4], [26,9],[28,11]],
                bars: {
                    show: true,
                    lineWidth: 0,
                    fillColor: '#ffffff8a'
                }
            }], {
                grid: {
                    show: false
                }
            });*/
            // Bar Chart #flotBarChart End
        });
    </script>
</body>
</html>
